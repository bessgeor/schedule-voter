{"version":3,"sources":["voting/types.ts","voting/VoteSelector.tsx","voting/Form.tsx","voting/VoteResultsDisplay.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Vote","voteToString","v","CantAttend","MayAttend","WantAttend","votes","Voter","vote","onVote","className","React","useMemo","moment","tourney","local","format","value","onChange","Number","target","map","VoteSelector","selection","onClose","date","actualVotes","type","onClick","dateFormat","DateButton","voteCounts","onSelect","idx","count","gw2AccRegex","disAccRegex","Form","viewResults","dates","staticName","onApprove","isLoading","gw2User","disUser","setGw2User","setDisUser","setVotes","old","o","isSame","approve","gw2Account","disAccount","voteSelection","setVoteSelection","closeVotes","groupedDates","linq","groupBy","d","startOf","x","vs","where","orderBy","toArray","times","select","original","els","sum","length","validationError","test","some","placeholder","e","gd","clNm","disAcc","gw2Acc","VoteResultForDate","may","filter","want","utc","VoteResultsDisplay","voted","goVote","useState","loading","setLoading","setLoaded","useCallback","results","setResults","useEffect","aborter","AbortController","fetch","method","signal","body","JSON","stringify","headers","then","json","finally","abort","usefulResults","generateDates","start","weeks","i","h","add","App","qs","parse","window","location","search","String","startDate","Array","from","lsKey","localStorage","getItem","setVotedState","setVoted","setItem","showVoteResults","setShowVoteResults","goResults","goVoting","voteResult","setVoteResult","resetVotes","catch","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9e735a67.chunk.js","sourcesContent":["import * as moment from 'moment'\r\n\r\nexport enum Vote {\r\n\tCantAttend = 0,\r\n\tMayAttend = 1,\r\n\tWantAttend = 2\r\n}\r\nexport function voteToString(v: Vote) {\r\n\tswitch (v) {\r\n\t\tcase Vote.CantAttend: return 'Не пойду'\r\n\t\tcase Vote.MayAttend: return 'Наверное пойду'\r\n\t\tcase Vote.WantAttend: return 'Пойду'\r\n\t}\r\n}\r\n\r\nexport type Voting = {\r\n\ttourney: moment.Moment\r\n\tvote: Vote\r\n}\r\n\r\nexport type Votes = {\r\n\tstaticName: string\r\n\tgw2Account: string\r\n\tdisAccount: string\r\n\tvotes: Voting[]\r\n}\r\n","import './voteSelector.css'\r\nimport React from 'react'\r\nimport * as moment from 'moment'\r\nimport { Vote, voteToString, Voting } from './types'\r\n\r\nexport type VoteSelection = {\r\n\tdate: string;\r\n\tactualVotes: Voting[]\r\n}\r\n\r\ntype VoterProps = {\r\n\tvote: Voting\r\n\tonVote: (vote: Voting) => void\r\n}\r\n\r\nconst votes = [\r\n\tVote.CantAttend,\r\n\tVote.MayAttend,\r\n\tVote.WantAttend\r\n]\r\n\r\nfunction Voter({ vote, onVote }: VoterProps) {\r\n\tconst className = React.useMemo(() => `voter voter__vote-${vote.vote}`, [vote.vote])\r\n\treturn (\r\n\t\t<div className={className}>\r\n\t\t\t<label>{moment.utc(vote.tourney).local().format(\"HH:mm\")}</label>\r\n\t\t\t<select value={vote.vote} onChange={v => onVote({ tourney: vote.tourney, vote: votes[Number(v.target.value)] })}>\r\n\t\t\t\t{votes.map(v => <option key={v} value={v}>{voteToString(v)}</option>)}\r\n\t\t\t</select>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport type VoteSelectorProps = {\r\n\tselection: VoteSelection\r\n\tonVote: (vote: Voting) => void\r\n\tonClose: () => void\r\n}\t\r\n\r\nexport function VoteSelector({ selection, onVote, onClose }: VoteSelectorProps) {\r\n\treturn (\r\n\t\t<div className=\"vote-selector\">\r\n\t\t\t<h1>{selection.date}</h1>\r\n\t\t\t<div className=\"vote-selector__date-list\">\r\n\t\t\t\t{selection.actualVotes.map(v => <Voter key={v.tourney.format(\"HH:mm\")} vote={v} onVote={onVote} />)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"submit-panel\">\r\n\t\t\t\t<button type=\"button\" className=\"submit-button\" onClick={onClose}>Готово!</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}","import './form.css'\r\nimport * as React from 'react'\r\nimport * as moment from 'moment'\r\nimport * as linq from 'linq'\r\nimport { Vote, Votes, voteToString, Voting } from './types'\r\nimport { VoteSelector } from './VoteSelector'\r\n\r\ntype CB<T> = (x: React.SetStateAction<T>) => void\r\n\r\nexport type Model = {\r\n\tisLoading: boolean\r\n\tviewResults: () => void\r\n\tdates: moment.Moment[]\r\n\tstaticName: string\r\n\tonApprove: (votes: Votes) => void\r\n\tgw2User: string\r\n\tdisUser: string\r\n\tvotes: Voting[]\r\n\tsetGw2User: CB<string>\r\n\tsetDisUser: CB<string>\r\n\tsetVotes: CB<Voting[]>\r\n}\r\n\r\nconst dateFormat = \"DD.MM.YYYY\"\r\n\r\nfunction DateButton({ voteCounts, onSelect, idx, date}: { date: string, voteCounts: { vote: Vote, count: number }[], idx: number, onSelect: (x: number) => void}) {\r\n\tconst onClick = React.useCallback(() => onSelect(idx), [onSelect, idx])\r\n\treturn (\r\n\t\t<div className=\"date-button\" onClick={onClick}>\r\n\t\t\t<b className=\"date-button__header\">{date}</b>\r\n\t\t\t<div className=\"date-button__votes\">\r\n\t\t\t\t{voteCounts.map(v => <small key={v.vote}>{voteToString(v.vote)}: {v.count}</small>)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nconst gw2AccRegex = /^.+\\.\\d\\d\\d\\d$/\r\nconst disAccRegex = /^.+\\#\\d\\d\\d\\d$/\r\n\r\nexport function Form({ viewResults, dates, staticName, onApprove, isLoading, gw2User, disUser, votes, setGw2User, setDisUser, setVotes }: Model) {\r\n\tconst onVote = React.useCallback((v: Voting) => setVotes(old => old.map(o => v.tourney.isSame(o.tourney) ? v : o)), [setVotes])\r\n\r\n\tconst approve = React.useCallback(() => onApprove({ staticName, gw2Account: gw2User, disAccount: disUser, votes }), [gw2User, disUser, votes, staticName, onApprove])\r\n\r\n\tconst [voteSelection, setVoteSelection] = React.useState<number | null>(null)\r\n\tconst closeVotes = React.useCallback(() => setVoteSelection(null), [setVoteSelection])\r\n\r\n\tconst groupedDates = React.useMemo(() => \r\n\t\tlinq.from(dates)\r\n\t\t.groupBy(\r\n\t\t\td => moment.utc(d).local().startOf('day').format(dateFormat),\r\n\t\t\tx => x,\r\n\t\t\t(date, vs) => {\r\n\t\t\t\tconst actualVotes = linq.from(votes).where(x => moment.utc(x.tourney).local().format(dateFormat) == date).orderBy(x => x.tourney).toArray()\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdate,\r\n\t\t\t\t\ttimes: vs.select(x => ({ local: moment.utc(x).local().format(\"HH:mm\"), original: x })).toArray(),\r\n\t\t\t\t\tactualVotes,\r\n\t\t\t\t\tvoteCounts: linq.from([\r\n\t\t\t\t\t\t{ vote: Vote.CantAttend, count: 0 },\r\n\t\t\t\t\t\t{ vote: Vote.MayAttend, count: 0 },\r\n\t\t\t\t\t\t{ vote: Vote.WantAttend, count: 0 },\r\n\t\t\t\t\t\t...actualVotes.map(x => ({ vote: x.vote, count: 1}))\r\n\t\t\t\t\t]).groupBy(x => x.vote, x => x, (vote, els) => ({ vote, count: els.sum(x => x.count) })).toArray()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t)\r\n\t\t.where(x => x.times.length > 0)\r\n\t\t.orderBy(x => x.date)\r\n\t\t.toArray()\r\n\t, [dates, votes])\r\n\r\n\tconst validationError = React.useMemo(() => {\r\n\t\tif (!gw2User)\r\n\t\t\treturn 'Введи ГВшный акк, чумба'\r\n\t\tif (!gw2AccRegex.test(gw2User))\r\n\t\t\treturn 'ГВшный акк - формата Choom.1234. Можешь посмотреть его в игре в френдлисте'\r\n\t\tif (!disUser)\r\n\t\t\treturn 'Введи акк диса, чумба'\r\n\t\tif (!disAccRegex.test(disUser))\r\n\t\t\treturn 'Акк диса - формата Choom#1234. Пишется в дисе слева внизу (на мобилке спрятан в левой шторке)'\r\n\t\tif (!votes.some(x => x.vote != Vote.CantAttend))\r\n\t\t\treturn 'Если никуда идти не хочешь, что ты тут забыл, чумба?'\r\n\t\tif (isLoading)\r\n\t\t\treturn 'Chill, choom, data is uploading'\r\n\t\treturn false\r\n\t}, [gw2User, disUser, votes, isLoading])\r\n\r\n\treturn (\r\n\t\t<div className=\"form\">\r\n\t\t\t{voteSelection !== null && <VoteSelector selection={groupedDates[voteSelection]} onVote={onVote} onClose={closeVotes} /> || null}\r\n\t\t\t<h1>Расписание статика {staticName} <button type=\"button\" className=\"submit-button\" onClick={viewResults}>Посмотреть результаты</button></h1>\r\n\t\t\t<div className=\"account-inputs\">\r\n\t\t\t\t<div className=\"account-name\">\r\n\t\t\t\t\t<label>Аккаунт GW2:</label>\r\n\t\t\t\t\t<input type=\"text\" placeholder=\"YourGW2AccName.1234\" value={gw2User} onChange={e => setGw2User(e.target.value)}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"account-name\">\r\n\t\t\t\t\t<label>Аккаунт Discord:</label>\r\n\t\t\t\t\t<input type=\"text\" placeholder=\"YourDiscordName#1234\" value={disUser} onChange={e => setDisUser(e.target.value)}/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"dates\">\r\n\t\t\t\t{groupedDates.map((gd, idx) => <DateButton key={gd.date} date={gd.date} voteCounts={gd.voteCounts} idx={idx} onSelect={setVoteSelection} />)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"submit-panel\">\r\n\t\t\t\t{validationError && <span className=\"validation-error\">{validationError}</span> || <button type=\"button\" className=\"submit-button\" onClick={approve}>Отправить</button>}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}","import './voteResultsDisplay.css'\r\nimport React from 'react'\r\nimport moment from 'moment'\r\nimport { Vote } from './types'\r\n\r\nexport type VoteResultsDisplayProps = {\r\n\tstaticName: string\r\n\tdates: moment.Moment[]\r\n\tvoted: boolean\r\n\tgoVote: () => void\r\n}\r\n\r\ntype VoteResult = {\r\n\tdate: moment.Moment\r\n\tvotes: {\r\n\t\tgw2Acc: string\r\n\t\tdisAcc: string\r\n\t\tvote: Vote\r\n\t}[]\r\n}\r\n\r\nfunction Voter(x: { gw2Acc: string, disAcc: string, className: string }) {\r\n\tconst clNm = React.useMemo(() => `voter ${x.className}`, [x.className])\r\n\treturn (\r\n\t\t<div className={clNm}>\r\n\t\t\t<span>{x.disAcc}</span>/<span>{x.gw2Acc}</span>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nfunction VoteResultForDate({date, votes} : VoteResult) {\r\n\tconst may = React.useMemo(() => votes.filter(x => x.vote == Vote.MayAttend), votes)\r\n\tconst want = React.useMemo(() => votes.filter(x => x.vote == Vote.WantAttend), votes)\r\n\r\n\treturn (\r\n\t\t<div className=\"vote-result\">\r\n\t\t\t<h2>{moment.utc(date).local().format(\"DD.MM.YYYY HHч\")}</h2>\r\n\t\t\t<div>Желающих: {want.length + may.length}</div>\r\n\t\t\t<div className=\"want\">Точно пойдут: {want.length}</div>\r\n\t\t\t<div className=\"may\">Наверное пойдут: {may.length}</div>\r\n\t\t\t<div className=\"voters\">\r\n\t\t\t\t{want.map(x => <Voter key={x.disAcc} className=\"want\" {...x} />)}\r\n\t\t\t\t{may.map(x => <Voter key={x.disAcc} className=\"may\" {...x} />)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport function VoteResultsDisplay({ staticName, dates, voted, goVote }: VoteResultsDisplayProps) {\r\n\tconst [loading, setLoading] = React.useState(true)\r\n\tconst setLoaded = React.useCallback(() => setLoading(false), [setLoading])\r\n\tconst [results, setResults] = React.useState<VoteResult[]>([])\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst aborter = new AbortController()\r\n\t\tfetch('/api/results', {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tsignal: aborter.signal,\r\n\t\t\tbody: JSON.stringify({ staticName, dates }),\r\n\t\t\theaders: {\r\n\t\t\t\t['content-type']: 'application/json'\r\n\t\t\t}\r\n\t\t}).then(x => x.json()).then((x: any[]) => x.map(x => ({ ...x, date: moment.utc(x.date) }))).then(setResults).finally(setLoaded)\r\n\t\treturn () => aborter.abort()\r\n\t}, [42])\r\n\r\n\tconst usefulResults = React.useMemo(() => results.map(x => ({date: x.date, votes: x.votes.filter(x => x.vote != Vote.CantAttend)})).filter(x => x.votes.length > 0), [results])\r\n\r\n\tif (loading)\r\n\t\treturn <span>Загружается...</span>\r\n\r\n\tif (usefulResults.length == 0)\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<div>Никто пока не проголосовал</div>\r\n\t\t\t\t<button type=\"button\" onClick={goVote}>Проголосовать!</button>\r\n\t\t\t</>\r\n\t\t)\r\n\r\n\treturn (\r\n\t\t<div className=\"vote-results\">\r\n\t\t\t<div className=\"vote-results__dates\">\r\n\t\t\t\t{usefulResults.map(x => <VoteResultForDate key={x.date.format(\"YYYY-MM-DD HHч\")} {...x} />)}\r\n\t\t\t</div>\r\n\t\t\t<button type=\"button\" onClick={goVote}>{voted ? 'Проголосовать заново' : 'Проголосовать'}</button>\r\n\t\t</div>\r\n\t)\r\n}","import React from 'react'\r\nimport * as moment from 'moment'\r\nimport { parse } from 'query-string'\r\nimport { Form } from './voting/Form'\r\nimport { Vote, Votes } from './voting/types'\r\nimport { VoteResultsDisplay } from './voting/VoteResultsDisplay'\r\n\r\nmoment.locale('ru')\r\n\r\nfunction* generateDates(start: moment.Moment, weeks: number) {\r\n  for (let i = 0; i < weeks*7; i++)\r\n    for (let h = 0; h < 24; h += 3)\r\n      yield moment.utc(start).add(i, 'days').add(h, 'hours')\r\n}\r\n\r\nfunction App() {\r\n  const qs = React.useMemo(() => parse(window.location.search), [parse])\r\n  const { staticName, startDate, weeks } = React.useMemo(() => ({\r\n    staticName: String(qs['staticName']),\r\n    startDate: moment.utc(qs['startDate']),\r\n    weeks: Number(qs['weeks'])\r\n  }), [qs])\r\n  const dates = React.useMemo(() => Array.from(generateDates(startDate, weeks)), [startDate, weeks])\r\n\r\n  const lsKey = React.useMemo(() => \"voted-\" + staticName + startDate.format(\"-YYYY-MM-DD-\") + weeks, [staticName, startDate, weeks])\r\n\r\n  const [voted, setVotedState] = React.useState(() => window.localStorage.getItem(lsKey) !== null)\r\n  const setVoted = React.useCallback(() => {\r\n    setVotedState(true)\r\n    window.localStorage.setItem(lsKey, 'true')\r\n  }, [setVotedState, lsKey])\r\n  const [showVoteResults, setShowVoteResults] = React.useState(voted)\r\n  const goResults = React.useCallback(() => setShowVoteResults(true), [setShowVoteResults])\r\n  const goVoting = React.useCallback(() => setShowVoteResults(false), [setShowVoteResults])\r\n\r\n\tconst [gw2User, setGw2User] = React.useState('')\r\n\tconst [disUser, setDisUser] = React.useState('')\r\n\r\n\tconst [votes, setVotes] = React.useState(() => dates.map(tourney => ({ tourney, vote: Vote.CantAttend })))\r\n\r\n  const [voteResult, setVoteResult] = React.useState<Votes | null>(null)\r\n  const onApprove = React.useCallback((votes: Votes) => setVoteResult(votes), [setVoteResult])\r\n  const resetVotes = React.useCallback(() => setVoteResult(null), [setVoteResult])\r\n\r\n  React.useEffect(() => {\r\n    if (voteResult)\r\n    {\r\n      const aborter = new AbortController()\r\n      fetch('/api/approve', {\r\n        method: 'PUT',\r\n        signal: aborter.signal,\r\n        body: JSON.stringify(voteResult),\r\n        headers: {\r\n          ['content-type']: 'application/json'\r\n        }\r\n      }).then(setVoted).then(resetVotes).catch(resetVotes)\r\n      return () => aborter.abort()\r\n    }\r\n  }, [voteResult])\r\n\r\n  return (\r\n    showVoteResults\r\n    ? <VoteResultsDisplay\r\n      staticName={staticName}\r\n      dates={dates}\r\n      voted={voted}\r\n      goVote={goVoting}\r\n    />\r\n    : <Form\r\n      isLoading={voteResult != null}\r\n      viewResults={goResults}\r\n      dates={dates}\r\n      staticName={staticName}\r\n      onApprove={onApprove}\r\n      votes={votes}\r\n      setVotes={setVotes}\r\n      gw2User={gw2User}\r\n      setGw2User={setGw2User}\r\n      disUser={disUser}\r\n      setDisUser={setDisUser}\r\n    />\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}