(this["webpackJsonpschedule-voter-front"]=this["webpackJsonpschedule-voter-front"]||[]).push([[0],{20:function(t,e,n){},35:function(t,e,n){},37:function(t,e,n){},39:function(t,e,n){},40:function(t,e,n){"use strict";n.r(e);var a,c=n(1),r=n.n(c),o=n(14),s=n.n(o),u=(n(20),n(4)),i=n(3),l=n(11),d=n.n(l),j=n(2),b=n.n(j),f=n(12),m=n(15),v=(n(35),n(8));function h(t){switch(t){case a.CantAttend:return"\u041d\u0435 \u043f\u043e\u0439\u0434\u0443";case a.MayAttend:return"\u041d\u0430\u0432\u0435\u0440\u043d\u043e\u0435 \u043f\u043e\u0439\u0434\u0443";case a.WantAttend:return"\u041f\u043e\u0439\u0434\u0443"}}!function(t){t[t.CantAttend=0]="CantAttend",t[t.MayAttend=1]="MayAttend",t[t.WantAttend=2]="WantAttend"}(a||(a={}));n(37);var O=n(0),x=[a.CantAttend,a.MayAttend,a.WantAttend];function p(t){var e=t.vote,n=t.onVote,a=r.a.useMemo((function(){return"voter voter__vote-".concat(e.vote)}),[e.vote]);return Object(O.jsxs)("div",{className:a,children:[Object(O.jsx)("label",{children:j.utc(e.tourney).local().format("HH:mm")}),Object(O.jsx)("select",{value:e.vote,onChange:function(t){return n({tourney:e.tourney,vote:x[Number(t.target.value)]})},children:x.map((function(t){return Object(O.jsx)("option",{value:t,children:h(t)},t)}))})]})}function y(t){var e=t.selection,n=t.onVote,a=t.onClose;return Object(O.jsxs)("div",{className:"vote-selector",children:[Object(O.jsx)("h1",{children:e.date}),Object(O.jsx)("div",{className:"vote-selector__date-list",children:e.actualVotes.map((function(t){return Object(O.jsx)(p,{vote:t,onVote:n},t.tourney.format("HH:mm"))}))}),Object(O.jsx)("div",{className:"submit-panel",children:Object(O.jsx)("button",{type:"button",className:"submit-button",onClick:a,children:"\u0413\u043e\u0442\u043e\u0432\u043e!"})})]})}var N="DD.MM.YYYY";function g(t){var e=t.voteCounts,n=t.onSelect,a=t.idx,r=t.date,o=c.useCallback((function(){return n(a)}),[n,a]);return Object(O.jsxs)("div",{className:"date-button",onClick:o,children:[Object(O.jsx)("b",{className:"date-button__header",children:r}),Object(O.jsx)("div",{className:"date-button__votes",children:e.map((function(t){return Object(O.jsxs)("small",{children:[h(t.vote),": ",t.count]},t.vote)}))})]})}var C=/^.+\.\d\d\d\d$/,A=/^.+\#\d\d\d\d$/;function w(t){var e=t.viewResults,n=t.dates,r=t.staticName,o=t.onApprove,s=t.isLoading,u=t.gw2User,l=t.disUser,d=t.votes,b=t.setGw2User,f=t.setDisUser,h=t.setVotes,x=c.useCallback((function(t){return h((function(e){return e.map((function(e){return t.tourney.isSame(e.tourney)?t:e}))}))}),[h]),p=c.useCallback((function(){return o({staticName:r,gw2Account:u,disAccount:l,votes:d})}),[u,l,d,r,o]),w=c.useState(null),k=Object(i.a)(w,2),M=k[0],S=k[1],Y=c.useCallback((function(){return S(null)}),[S]),D=c.useMemo((function(){return v.from(n).groupBy((function(t){return j.utc(t).local().startOf("day").format(N)}),(function(t){return t}),(function(t,e){var n=v.from(d).where((function(e){return j.utc(e.tourney).local().format(N)==t})).orderBy((function(t){return t.tourney})).toArray();return{date:t,times:e.select((function(t){return{local:j.utc(t).local().format("HH:mm"),original:t}})).toArray(),actualVotes:n,voteCounts:v.from([{vote:a.CantAttend,count:0},{vote:a.MayAttend,count:0},{vote:a.WantAttend,count:0}].concat(Object(m.a)(n.map((function(t){return{vote:t.vote,count:1}}))))).groupBy((function(t){return t.vote}),(function(t){return t}),(function(t,e){return{vote:t,count:e.sum((function(t){return t.count}))}})).toArray()}})).where((function(t){return t.times.length>0})).orderBy((function(t){return t.date})).toArray()}),[n,d]),H=c.useMemo((function(){return u?C.test(u)?l?A.test(l)?d.some((function(t){return t.vote!=a.CantAttend}))?!!s&&"Chill, choom, data is uploading":"\u0415\u0441\u043b\u0438 \u043d\u0438\u043a\u0443\u0434\u0430 \u0438\u0434\u0442\u0438 \u043d\u0435 \u0445\u043e\u0447\u0435\u0448\u044c, \u0447\u0442\u043e \u0442\u044b \u0442\u0443\u0442 \u0437\u0430\u0431\u044b\u043b, \u0447\u0443\u043c\u0431\u0430?":"\u0410\u043a\u043a \u0434\u0438\u0441\u0430 - \u0444\u043e\u0440\u043c\u0430\u0442\u0430 Choom#1234. \u041f\u0438\u0448\u0435\u0442\u0441\u044f \u0432 \u0434\u0438\u0441\u0435 \u0441\u043b\u0435\u0432\u0430 \u0432\u043d\u0438\u0437\u0443 (\u043d\u0430 \u043c\u043e\u0431\u0438\u043b\u043a\u0435 \u0441\u043f\u0440\u044f\u0442\u0430\u043d \u0432 \u043b\u0435\u0432\u043e\u0439 \u0448\u0442\u043e\u0440\u043a\u0435)":"\u0412\u0432\u0435\u0434\u0438 \u0430\u043a\u043a \u0434\u0438\u0441\u0430, \u0447\u0443\u043c\u0431\u0430":"\u0413\u0412\u0448\u043d\u044b\u0439 \u0430\u043a\u043a - \u0444\u043e\u0440\u043c\u0430\u0442\u0430 Choom.1234. \u041c\u043e\u0436\u0435\u0448\u044c \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0435\u0433\u043e \u0432 \u0438\u0433\u0440\u0435 \u0432 \u0444\u0440\u0435\u043d\u0434\u043b\u0438\u0441\u0442\u0435":"\u0412\u0432\u0435\u0434\u0438 \u0413\u0412\u0448\u043d\u044b\u0439 \u0430\u043a\u043a, \u0447\u0443\u043c\u0431\u0430"}),[u,l,d,s]);return Object(O.jsxs)("div",{className:"form",children:[null!==M&&Object(O.jsx)(y,{selection:D[M],onVote:x,onClose:Y})||null,Object(O.jsxs)("h1",{children:["\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0438\u043a\u0430 ",r," ",Object(O.jsx)("button",{type:"button",className:"submit-button",onClick:e,children:"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b"})]}),Object(O.jsxs)("div",{className:"account-inputs",children:[Object(O.jsxs)("div",{className:"account-name",children:[Object(O.jsx)("label",{children:"\u0410\u043a\u043a\u0430\u0443\u043d\u0442 GW2:"}),Object(O.jsx)("input",{type:"text",placeholder:"YourGW2AccName.1234",value:u,onChange:function(t){return b(t.target.value)}})]}),Object(O.jsxs)("div",{className:"account-name",children:[Object(O.jsx)("label",{children:"\u0410\u043a\u043a\u0430\u0443\u043d\u0442 Discord:"}),Object(O.jsx)("input",{type:"text",placeholder:"YourDiscordName#1234",value:l,onChange:function(t){return f(t.target.value)}})]})]}),Object(O.jsx)("div",{className:"dates",children:D.map((function(t,e){return Object(O.jsx)(g,{date:t.date,voteCounts:t.voteCounts,idx:e,onSelect:S},t.date)}))}),Object(O.jsx)("div",{className:"submit-panel",children:H&&Object(O.jsx)("span",{className:"validation-error",children:H})||Object(O.jsx)("button",{type:"button",className:"submit-button",onClick:p,children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})]})}var k=n(5);n(39);function M(t){var e=r.a.useMemo((function(){return"voter ".concat(t.className)}),[t.className]);return Object(O.jsxs)("div",{className:e,children:[Object(O.jsx)("span",{children:t.disAcc}),"/",Object(O.jsx)("span",{children:t.gw2Acc})]})}function S(t){var e=t.date,n=t.votes,c=r.a.useMemo((function(){return n.filter((function(t){return t.vote==a.MayAttend}))}),n),o=r.a.useMemo((function(){return n.filter((function(t){return t.vote==a.WantAttend}))}),n);return Object(O.jsxs)("div",{className:"vote-result",children:[Object(O.jsx)("h2",{children:b.a.utc(e).local().format("DD.MM.YYYY HH\u0447")}),Object(O.jsxs)("div",{children:["\u0416\u0435\u043b\u0430\u044e\u0449\u0438\u0445: ",o.length+c.length]}),Object(O.jsxs)("div",{className:"want",children:["\u0422\u043e\u0447\u043d\u043e \u043f\u043e\u0439\u0434\u0443\u0442: ",o.length]}),Object(O.jsxs)("div",{className:"may",children:["\u041d\u0430\u0432\u0435\u0440\u043d\u043e\u0435 \u043f\u043e\u0439\u0434\u0443\u0442: ",c.length]}),Object(O.jsxs)("div",{className:"voters",children:[o.map((function(t){return Object(O.jsx)(M,Object(k.a)({className:"want"},t),t.disAcc)})),c.map((function(t){return Object(O.jsx)(M,Object(k.a)({className:"may"},t),t.disAcc)}))]})]})}function Y(t){var e=t.staticName,n=t.dates,c=t.voted,o=t.goVote,s=r.a.useState(!0),l=Object(i.a)(s,2),d=l[0],j=l[1],f=r.a.useCallback((function(){return j(!1)}),[j]),m=r.a.useState([]),v=Object(i.a)(m,2),h=v[0],x=v[1];r.a.useEffect((function(){var t=new AbortController;return fetch("/api/results",{method:"POST",signal:t.signal,body:JSON.stringify({staticName:e,dates:n}),headers:Object(u.a)({},"content-type","application/json")}).then((function(t){return t.json()})).then((function(t){return t.map((function(t){return Object(k.a)(Object(k.a)({},t),{},{date:b.a.utc(t.date)})}))})).then(x).finally(f),function(){return t.abort()}}),[42]);var p=r.a.useMemo((function(){return h.map((function(t){return{date:t.date,votes:t.votes.filter((function(t){return t.vote!=a.CantAttend}))}})).filter((function(t){return t.votes.length>0}))}),[h]);return d?Object(O.jsx)("span",{children:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f..."}):0==p.length?Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{children:"\u041d\u0438\u043a\u0442\u043e \u043f\u043e\u043a\u0430 \u043d\u0435 \u043f\u0440\u043e\u0433\u043e\u043b\u043e\u0441\u043e\u0432\u0430\u043b"}),Object(O.jsx)("button",{type:"button",onClick:o,children:"\u041f\u0440\u043e\u0433\u043e\u043b\u043e\u0441\u043e\u0432\u0430\u0442\u044c!"})]}):Object(O.jsxs)("div",{className:"vote-results",children:[Object(O.jsx)("div",{className:"vote-results__dates",children:p.map((function(t){return Object(O.jsx)(S,Object(k.a)({},t),t.date.format("YYYY-MM-DD HH\u0447"))}))}),Object(O.jsx)("button",{type:"button",onClick:o,children:c?"\u041f\u0440\u043e\u0433\u043e\u043b\u043e\u0441\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e":"\u041f\u0440\u043e\u0433\u043e\u043b\u043e\u0441\u043e\u0432\u0430\u0442\u044c"})]})}var D=d.a.mark(H);function H(t,e){var n,a;return d.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=0;case 1:if(!(n<7*e)){c.next=12;break}a=0;case 3:if(!(a<24)){c.next=9;break}return c.next=6,j.utc(t).add(n,"days").add(a,"hours");case 6:a+=3,c.next=3;break;case 9:n++,c.next=1;break;case 12:case"end":return c.stop()}}),D)}j.locale("ru");var V=function(){var t=r.a.useMemo((function(){return Object(f.parse)(window.location.search)}),[f.parse]),e=r.a.useMemo((function(){return{staticName:String(t.staticName),startDate:j.utc(t.startDate),weeks:Number(t.weeks)}}),[t]),n=e.staticName,c=e.startDate,o=e.weeks,s=r.a.useMemo((function(){return Array.from(H(c,o))}),[c,o]),l=r.a.useMemo((function(){return"voted-"+n+c.format("-YYYY-MM-DD-")+o}),[n,c,o]),d=r.a.useState((function(){return null!==window.localStorage.getItem(l)})),b=Object(i.a)(d,2),m=b[0],v=b[1],h=r.a.useCallback((function(){v(!0),window.localStorage.setItem(l,"true")}),[v,l]),x=r.a.useState(m),p=Object(i.a)(x,2),y=p[0],N=p[1],g=r.a.useCallback((function(){return N(!0)}),[N]),C=r.a.useCallback((function(){return N(!1)}),[N]),A=r.a.useState(""),k=Object(i.a)(A,2),M=k[0],S=k[1],D=r.a.useState(""),V=Object(i.a)(D,2),_=V[0],U=V[1],W=r.a.useState((function(){return s.map((function(t){return{tourney:t,vote:a.CantAttend}}))})),B=Object(i.a)(W,2),F=B[0],G=B[1],I=r.a.useState(null),J=Object(i.a)(I,2),L=J[0],P=J[1],T=r.a.useCallback((function(t){return P(t)}),[P]),E=r.a.useCallback((function(){return P(null)}),[P]);return r.a.useEffect((function(){if(L){var t=new AbortController;return fetch("/api/approve",{method:"PUT",signal:t.signal,body:JSON.stringify(L),headers:Object(u.a)({},"content-type","application/json")}).then(h).then(E).catch(E),function(){return t.abort()}}}),[L]),y?Object(O.jsx)(Y,{staticName:n,dates:s,voted:m,goVote:C}):Object(O.jsx)(w,{isLoading:null!=L,viewResults:g,dates:s,staticName:n,onApprove:T,votes:F,setVotes:G,gw2User:M,setGw2User:S,disUser:_,setDisUser:U})},_=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,41)).then((function(e){var n=e.getCLS,a=e.getFID,c=e.getFCP,r=e.getLCP,o=e.getTTFB;n(t),a(t),c(t),r(t),o(t)}))};s.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(V,{})}),document.getElementById("root")),_()}},[[40,1,2]]]);
//# sourceMappingURL=main.9e735a67.chunk.js.map